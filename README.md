# UsbBootLock

**UsbBootLock** — это легковесное решение для обеспечения безопасности загрузки Linux-систем. Проект реализует механизм двухфакторной аутентификации на уровне загрузки, требуя наличия физического USB-накопителя с определенным серийным номером для продолжения работы системы.

## Особенности

- **Аппаратная привязка:** Система не загрузится без подключенного доверенного USB-устройства.
- **Интеграция с initramfs/mkinitcpio:** Проверка происходит на раннем этапе загрузки, до монтирования основной файловой системы.
- **Автоматическое выключение:** Если устройство не обнаружено в течение заданного времени (30 секунд), система автоматически выключается для предотвращения несанкционированного доступа.
- **Визуальная индикация:** Обратный отсчет и сообщения о статусе выводятся прямо в системную консоль при загрузке.

## Технологический стек

- **Язык:** Shell (POSIX compliant)
- **Инструментарий:** initramfs-tools (Debian/Ubuntu), mkinitcpio (Arch Linux), dracut (Fedora/RHEL), lsusb, systemd/sysvinit poweroff
- **Целевая платформа:** Linux (любой дистрибутив, поддерживающий initramfs/mkinitcpio/dracut)

## Как установить

### 1. Подготовка

**Установите необходимые пакеты:**

- **Debian/Ubuntu:**
  ```bash
  sudo apt update
  sudo apt install initramfs-tools usbutils
  ```

- **Arch Linux/Manjaro:**
  ```bash
  sudo pacman -S mkinitcpio usbutils
  ```

- **Fedora/RHEL:**
  ```bash
  sudo dnf install dracut usbutils # или yum
  ```

### 2. Получение файлов проекта

Клонируйте репозиторий:
```bash
git clone https://github.com/Bolotnik-ss/UsbBootLock.git
cd UsbBootLock
```

### 3. Определение серийного номера USB

1. Подключите ваш USB-накопитель.
2. Найдите его идентификатор (ID XXXX:YYYY) с помощью `lsusb`.
3. Получите серийный номер:
   ```bash
   sudo lsusb -v -d XXXX:YYYY | grep iSerial
   ```
   *Пример вывода:* `iSerial                 3 1234567890ABCDEF`

### 4. Установка

   **a) Автоматическая установка с помощью скрипта**

   Запустите скрипт установки `install.sh` из корневой директории проекта:

   ```bash
   ./install.sh "ВАШ_СЕРИЙНЫЙ_НОМЕР"
   ```

   - Замените `"ВАШ_СЕРИЙНЫЙ_НОМЕР"` на серийный номер, полученный на предыдущем шаге.
   - Если вы запустите скрипт без аргумента, он запросит серийный номер интерактивно.

   **Если вы используете Arch Linux, скрипт автоматически настроит `mkinitcpio`.**

   **b) Ручная установка (если автоматическая не удалась или для понимания процесса)**

   1. Скопируйте скрипт `usb-lock.sh` (который находится в корне клонированного репозитория) в соответствующую директорию:
      - **Debian/Ubuntu:** `sudo cp usb-lock.sh /etc/initramfs-tools/scripts/init-bottom/`
      - **Arch Linux:** Скопируйте `usb-lock.sh` в `/etc/initcpio/hooks/` и создайте соответствующий файл хука в `/etc/initcpio/install/` (см. пример в `install.sh`).
      - **Fedora/RHEL:** Скопируйте скрипт в `/usr/lib/dracut/modules.d/90usblock/` (возможно, потребуется создать директорию).

   2. Установите права на выполнение для скопированного скрипта:
      ```bash
      sudo chmod +x /путь/к/скрипту/usb-lock.sh
      ```

   3. Обновите образ `initramfs`:
      - **Debian/Ubuntu:** `sudo update-initramfs -u`
      - **Arch Linux:** `sudo mkinitcpio -P`
      - **Fedora/RHEL:** `sudo dracut -f`

## Использование

После установки и перезагрузки система при каждой загрузке будет искать указанный USB-накопитель.

- Если устройство подключено — загрузка продолжается мгновенно.
- Если устройство отсутствует — начнется 30-секундный отсчет. Если за это время вы не подключите накопитель, компьютер выключится.

## Удаление

Чтобы удалить `UsbBootLock` из системы:

1.  **Через скрипт установки (рекомендуется):**
    Запустите скрипт с опцией `--uninstall` или `--remove` (если такая опция будет добавлена в скрипт).
    *В данный момент скрипт `install.sh` не поддерживает удаление. Для удаления выполните шаги ниже.* 

2.  **Ручное удаление:**
    - Удалите скрипт из директории `initramfs` (используйте путь, указанный при установке):
      ```bash
      # Пример для Debian/Ubuntu:
      sudo rm /etc/initramfs-tools/scripts/init-bottom/usb-lock.sh
      # Пример для Arch Linux (удалите хук и файл из install):
      sudo rm /etc/initcpio/hooks/usb-lock.sh
      sudo rm /etc/initcpio/install/usb-lock.sh
      ```
    - Если вы использовали Dracut, удалите скрипт и директорию.

    - Обновите образ `initramfs`:
      ```bash
      # Debian/Ubuntu:
      sudo update-initramfs -u
      # Arch Linux:
      sudo mkinitcpio -P
      # Fedora/RHEL:
      sudo dracut -f
      ```

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле [LICENSE](LICENSE).

---
*Проект разработан как демонстрация возможностей по усилению безопасности загрузки Linux-систем с использованием аппаратной аутентификации.*
